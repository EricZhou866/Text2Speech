<!DOCTYPE html>
<html>
<head>
    <title>Text-to-Speech</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { text-align: center; }
        textarea { 
            width: 100%; 
            height: 100px; 
            font-size: 16px; 
            padding: 10px; 
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        button { 
            padding: 10px 20px;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .download-btn {
            background-color: #2196F3;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #status {
            text-align: center;
            margin: 10px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Text-to-Speech (文字转语音)</h1>
    
    <textarea id="text-input" placeholder="Enter text here (支持中文和英文)"></textarea>
    
    <div class="controls">
        <button id="convert-btn" onclick="convertToSpeech()">Convert to Speech</button>
    </div>

    <div id="status"></div>
    
    <audio id="audio-player" style="width: 100%; margin-top: 20px; display:none;" controls>
        Your browser does not support the audio element.
    </audio>

    <div id="download-container" style="text-align: center; margin-top: 20px;">
        <button id="download-btn" class="download-btn" style="display: none;" onclick="downloadMP3()">
            Download MP3
        </button>
    </div>
    
    <script>
        let audioBlob = null;

        async function convertToSpeech() {
            const textInput = document.getElementById("text-input").value;
            const convertBtn = document.getElementById("convert-btn");
            const audioPlayer = document.getElementById("audio-player");
            const downloadBtn = document.getElementById("download-btn");
            const statusElement = document.getElementById("status");

            if (!textInput.trim()) {
                alert("Please enter some text");
                return;
            }

            // Disable button and show status
            convertBtn.disabled = true;
            statusElement.textContent = "Converting...";
            downloadBtn.style.display = "none";
            audioPlayer.style.display = "none";

            try {
                const response = await fetch('/tts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: textInput })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                audioBlob = await response.blob();
                const url = URL.createObjectURL(audioBlob);

                // Set up audio player
                audioPlayer.src = url;
                audioPlayer.style.display = "block";
                downloadBtn.style.display = "block";
                
                // Auto play
                audioPlayer.play();
                statusElement.textContent = "Conversion complete!";

            } catch (error) {
                console.error('Error:', error);
                statusElement.textContent = "Error occurred during conversion!";
            } finally {
                convertBtn.disabled = false;
            }
        }

        function downloadMP3() {
            if (audioBlob) {
                const url = URL.createObjectURL(audioBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'speech.mp3';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }
    </script>
</body>
</html>
